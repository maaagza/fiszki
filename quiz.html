<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiszki Angielski - Quiz</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <h1>Quiz üß†</h1>
        
        <div id="quizArea" class="card quiz-card">
            <h2>Zaliczone s≈Ç√≥wka: <span id="score">0</span> / <span id="total">0</span></h2>
            
            <p>Przet≈Çumacz s≈Çowo:</p>
            <div id="promptWord" class="prompt"></div>
            
            <input type="text" id="answerInput" placeholder="Wpisz t≈Çumaczenie i naci≈õnij Enter">
            
            <div id="feedback"></div>
            <button id="acceptBtn" class="button hidden">Zalicz</button>
        </div>
        
        <div id="quizEnd" class="card hidden">
            <h2>Quiz zako≈Ñczony! üéâ</h2>
            <p>≈öwietna robota! Uda≈Ço Ci siƒô poprawnie odpowiedzieƒá na wszystkie s≈Ç√≥wka.</p>
            <p class="final-score" id="finalScore"></p>
            <a href="index.html" class="button">Wr√≥ƒá do strony g≈Ç√≥wnej</a>
        </div>
    </div>

    <script>
        // === ELEMENTY DOM ===
        const scoreEl = document.getElementById('score');
        const totalEl = document.getElementById('total');
        const promptWordEl = document.getElementById('promptWord');
        const answerInput = document.getElementById('answerInput');
        const feedbackEl = document.getElementById('feedback');
        const acceptBtn = document.getElementById('acceptBtn');
        const quizArea = document.getElementById('quizArea');
        const quizEnd = document.getElementById('quizEnd');
        const finalScoreEl = document.getElementById('finalScore');
        
        // === ZMIENNE QUIZU ===
        let allWords = [];
        let wordsToQuiz = [];
        let currentWord = null;
        let correctAnswers = 0;

        // === FUNKCJE ===

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadNextWord() {
            if (wordsToQuiz.length === 0) {
                endQuiz();
                return;
            }

            currentWord = wordsToQuiz[0];
            promptWordEl.textContent = currentWord.original;

            answerInput.value = '';
            feedbackEl.innerHTML = '';
            acceptBtn.classList.add('hidden');
            answerInput.disabled = false;
            answerInput.focus();
        }
        
        function checkAnswer() {
            if (!currentWord) return;

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = currentWord.translation.trim().toLowerCase();

            answerInput.disabled = true;

            if (userAnswer === correctAnswer) {
            wordsToQuiz.shift();
            correctAnswers++;
            scoreEl.textContent = correctAnswers;

            feedbackEl.textContent = '‚úÖ Dobrze!';
            feedbackEl.className = 'correct';

            // Najpierw natychmiastowe odblokowanie pola
            answerInput.disabled = false;

            // iOS hack ‚Äì skup siƒô od razu, zanim klawiatura zniknie
            answerInput.focus({ preventScroll: true });

            // Teraz dopiero po chwili zmie≈Ñ s≈Çowo
            setTimeout(() => {
                loadNextWord();

                // Dodatkowy focus po wczytaniu nowego s≈Çowa (dla Androida / desktopu)
                setTimeout(() => answerInput.focus({ preventScroll: true }), 50);
            }, 1000);
            } else {
                feedbackEl.innerHTML = `‚ùå B≈ÇƒÖd! Poprawna odpowied≈∫: <strong>${currentWord.translation}</strong>. <br><small>Naci≈õnij Enter, aby spr√≥bowaƒá p√≥≈∫niej, lub "Zalicz".</small>`;
                feedbackEl.className = 'incorrect';
                
                acceptBtn.classList.remove('hidden');
                
                answerInput.disabled = false;
                answerInput.focus();
            }
        }
        
        function endQuiz() {
            quizArea.classList.add('hidden');
            quizEnd.classList.remove('hidden');
            finalScoreEl.textContent = `${correctAnswers} / ${allWords.length}`;
        }
        
        // === INICJALIZACJA QUIZU ===
        document.addEventListener('DOMContentLoaded', () => {
            const storedWords = localStorage.getItem('flashcards');
            if (storedWords) {
                allWords = JSON.parse(storedWords);
                wordsToQuiz = [...allWords];
            }

            if (allWords.length === 0) {
                alert("Brak s≈Ç√≥wek do nauki! Wr√≥ƒá na stronƒô g≈Ç√≥wnƒÖ, aby je dodaƒá.");
                window.location.href = 'index.html';
                return;
            }

            shuffleArray(wordsToQuiz);
            totalEl.textContent = allWords.length;
            loadNextWord();
        });

        // === EVENT LISTENERS ===

        answerInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                if (feedbackEl.innerHTML !== '' && !acceptBtn.classList.contains('hidden')) {
                    // Przesu≈Ñ s≈Çowo na koniec kolejki
                    const incorrectWord = wordsToQuiz.shift();
                    wordsToQuiz.push(incorrectWord);
                    // KLUCZOWA ZMIANA: Usuniƒôto ponowne tasowanie w tym miejscu!
                    loadNextWord();
                } else {
                    checkAnswer();
                }
            }
        });

        acceptBtn.addEventListener('click', () => {
            wordsToQuiz.shift();
            correctAnswers++;
            scoreEl.textContent = correctAnswers;
            loadNextWord();
        });
    </script>
</body>
</html>